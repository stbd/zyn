<!doctype html>
<head>
    <title>Zyn - Fileserver</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.slim.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/showdownjs/showdown/1.8.6/dist/showdown.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.0.489/pdf.js"></script>
    <link rel="stylesheet" href="{{ static_url('zyn.css') }}">
    <script type="text/javascript" src="{{ static_url('zyn.js') }}"></script>
    <script type="text/javascript" src="{{ static_url('files.js') }}"></script>
    <script type="text/javascript" src="{{ static_url('zyn-file-rendering.js') }}"></script>
    <script type="text/javascript" src="{{ static_url('utf8.js') }}"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <div id="zyn-login-modal" class="w3-modal" style="display: none;">
        <div class="w3-modal-content">

            <div class="w3-container">
                <h2 class="w3-center">Zyn - Login</h2>
                <form class="w3-container" method="post">
                    <label>Username</label>
                    <input class="w3-input w3-border w3-light-grey" type="text" name="username" autofocus>

                    <label>Password</label>
                    <input class="w3-input w3-border w3-light-grey" type="password" name="password">
                    <br />
                    <input class="w3-button w3-blue-grey" type="submit" value="Login">
                </form>
            </div>
        </div>
    </div>

    <div id="zyn-error-modal" class="w3-modal" style="display: none;">
        <div class="w3-modal-content">
            <div class="w3-container w3-center">
                <h2>There was a problem with the service</h2>
                <h3 id="zyn-error-criticality"></h3>
                <p id="zyn-error-description"></p>

                <p id="zyn-error-detail"></p>
                <button
                    id="zyn-button-show-error-detail"
                    class="w3-button w3-border"
                    onclick='(function() { document.getElementById("zyn-error-detail").style.display="block"; })()'
                >Show detail</button>

                <button
                    class="w3-button w3-border"
                    onclick='(function() { document.getElementById("zyn-error-modal").style.display="none"; })()'
                >Ok</button>
            </div>
        </div>
    </div>

    <div id="zyn-ask-user-modal" class="w3-modal" style="display: none;">
        <div class="w3-modal-content">
            <div class="w3-container w3-center">
                <h3 id="zyn-ask-user-description"></h3>

                <button
                    class="w3-button w3-border"
                    onclick='(function() { document.getElementById("zyn-ask-user-modal").style.display="none"; _ask_user_modal_continue(); })()'
                >Continue</button>

                <button
                    class="w3-button w3-border"
                    onclick='(function() { document.getElementById("zyn-ask-user-modal").style.display="none"; })()'
                >Cancel</button>
            </div>
        </div>
    </div>

    <div id="zyn-loading-modal" class="w3-modal" style="display: none;">
        <div class="w3-modal-content">
            <div class="w3-container w3-center">
                <h2>Loading</h2>
                <div class="zyn-load"></div>
            </div>
        </div>
    </div>

    <div class="w3-container w3-bar w3-black">
        <button class="w3-bar-item w3-button" onclick="_set_vissible_tab(tab_name_files)">Filesystem</button>
        <button class="w3-bar-item w3-button" onclick="_set_vissible_tab(tab_name_settings)">Settings</button>
    </div>

    <div id="tab-files" class="zyn-tabs" style="display:none">

        <div id="zyn-sidebar" class="w3-sidebar w3-bar-block w3-border" style="width: 25%; overflow: auto">
            <button type="button"
                    class="w3-button w3-border w3-center w3-block"
                    style="font-size: large"
                    onclick="_handle_toggle_sidebar_button_clicked()"
            >‚ü∫</button>

            <div class="w3-bar-item" style="min-width: 200px;">
                <fieldset>
                    <legend>Working Directory</legend>
                    <div>
                        <input id="zyn-current-path" type="text" class="w3-input" disabled></input>
                    </div>
                    <button id="zyn-button-parent-directory"
                            href="#"
                            class="w3-button w3-border"
                            onclick="_handle_parent_directory_clicked()"
                            style="width: 50%",
                    >Up</button>
                    <button id="zyn-button-refresh-content"
                            href="#"
                            class="w3-button w3-border w3-right"
                            onclick="_handle_refresh_content_clicked()"
                            style="width: 50%",
                    >Refresh</button>
                </fieldset>
            </div>

            <h3 class="w3-bar-item w3-center">Content</h3>

            <!--div class="w3-dropdown-hover" -->
            <div class="w3-dropdown-click" >
                <button class="w3-button w3-border" onclick="_toggle_create_element_content()">Create</button>
                <div id="input-create-element-content" class="w3-dropdown-content w3-bar-block w3-border">
                    Name:
                    <input id="input-create-element-name" class="w3-input w3-border w3-round" type="text">
                    Type:
                    <a class="w3-bar-item w3-button" onclick="_handle_create_random_access_clicked()" >File: Random Access</a>
                    <a class="w3-bar-item w3-button" onclick="_handle_create_direcotry_clicked()">Directory</a>
                </div>
            </div>
            <div id="zyn-workdir-content" style="min-width: 500px;"></div>
        </div>

        <div id="zyn-content" class="w3-container w3-margin-top w3-border">

            <fieldset >
                <legend>Current File</legend>
                <ul class="w3-ul w3-border-bottom">
                    <li class="w3-padding-small"><span>Name: </span><span id="zyn-current-file-name">null</span></li>
                    <li class="w3-padding-small"><span>Node Id: </span><span id="zyn-current-file-node-id">null</span></li>
                    <li class="w3-padding-small"><span>Type: </span><span id="zyn-current-file-type">null</span></li>
                    <li class="w3-padding-small"><span>Revision: </span><span id="zyn-current-file-revision">null</span></li>
                    <li class="w3-padding-small"><span>Encoding: </span><span id="zyn-current-file-encoding">null</span></li>
                </ul>
                <button id="zyn-current-file-button-edit" class="w3-bar-item w3-button w3-border" onclick="_handle_edit_clicked()">Edit</button>
                <button id="zyn-current-file-button-cancel" class="w3-bar-item w3-button w3-border" onclick="_handle_cancel_clicked()">Cancel</button>
                <button id="zyn-current-file-button-done" class="w3-bar-item w3-button w3-border" onclick="_handle_edit_done_clicked()">Done</button>
                <button id="zyn-current-file-button-save" class="w3-bar-item w3-button w3-border" onclick="_handle_save_edit_clicked()">Save</button>
            </fieldset>

            <div class="w3-border">
                <p class="w3-center">Notifications</p>
                <table id="zyn-notifications" class="w3-table">
                    <tr>
                        <th>Source</th>
                        <th>Description</th>
                    </tr>
                </table>
                <div class="w3-center">
                    <button
                        id="zyn-button-show-or-hide-notifications"
                        data-state="show"
                        class="w3-button w3-border"
                        onclick="_handle_show_hide_notifications_clicked()"
                    >Show</button>
                </div>
            </div>
            <div id="zyn-document-content" class="w3-border ">
                <h1 class="w3-center w3-opacity"><b>Content</b></h1>
            </div>

        </div>
  </div>

  <div id="tab-settings" class="zyn-tabs" style="display:none">
      <h2>Settings</h2>
      <h3>TODO</h3>
  </div>

  <script>
   class Transaction {
       constructor(on_success, state=null) {
           this._on_success = on_success;
           this._state = state;
       }

       state() {
           return this._state;
       }

       on_success(msg) {
           this._on_success(msg, this.state());
       }

       on_error(browser_error, web_server_error, zyn_server_error) {
           _hide_loading_indication();
           if (browser_error !== null) {
               alert('Browser error: ' + browser_error);
           } else if (web_server_error !== null) {
               alert('Web server error: ' + web_server_error);
           } else if (zyn_server_error !== null) {
               alert('Zyn server error: ' + zyn_server_error);
           } else {
               _unhandled('on_error: None of the errors were set')
           }
       }
   }

   class CurrentFile {
       constructor() {
           this._name = null;
           this._content = null;
           this._node_id = null;
           this._revision = null;
           this._type_of_file = null;
           this._extension = null;
           this._mode = null;
           this._encoding = null;
       }

       encoding() {
           return this._encoding;
       }

       is_set() {
           if (this._name === null) {
               return false;
           }
           return true;
       }

       change_to(name, node_id, revision, type_of_file, bytes) {
           if (CurrentFile.file_types.indexOf(type_of_file) === -1) {
               alert('unkdnown file type');
               return ;
           }

           this._name = name;
           this._node_id = node_id;
           this._revision = revision;
           this._type_of_file = type_of_file;
           this._bytes = bytes;
           this._mode = CurrentFile.mode_view;
           this._extension = zyn_get_file_extension(name);

           this._encoding = CurrentFile.encoding_binary;
           if (['md', 'txt'].indexOf(this._extension) !== -1) {
               this._encoding = CurrentFile.encoding_utf8;
           }
       }

       is_editable() {
           return is_editable_file(this._extension);
       }

       set_mode(mode) {
           if (CurrentFile.modes.indexOf(mode) === -1) {
               alert('1');
               return ;
           }
           this._mode = mode;
       }

       update_content(revision, content_bytes) {
           this._revision = revision;
           this._bytes = content_bytes;
           _add_notification(
               NOTIFICATION_SOURCE_BROWSER,
               'File with node Id ' + this._node_id + ' was updated to revision ' + this._revision
           );
       }

       decoded() {
           if (this._encoding == CurrentFile.encoding_utf8) {
               return utf8.decode(this._bytes);
           } else if (this._encoding == CurrentFile.encoding_utf8) {
               return unescape(this._bytes);
           } else {
               return this._bytes
           }
       }

       mode() { return this._mode; }
       file_extension() { return this._extension; }
       name() { return this._name; }
       node_id() { return this._node_id; }
       revision() { return this._revision; }
       type_of_file() { return this._type_of_file; }
       bytes() { return this._bytes; }
   };
   CurrentFile.mode_view = 'view';
   CurrentFile.mode_edit = 'edit';
   CurrentFile.modes = [CurrentFile.mode_view, CurrentFile.mode_edit];
   CurrentFile.file_type_random_access = 'random-access';
   CurrentFile.file_type_blob = 'blob';
   CurrentFile.file_types = [CurrentFile.file_type_random_access, CurrentFile.file_type_blob];

   CurrentFile.encoding_utf8 = 'utf8';
   CurrentFile.encoding_ascii = 'ascii';
   CurrentFile.encoding_binary = 'binary';
   CurrentFile.encoding_types = [CurrentFile.encoding_utf8, CurrentFile.encoding_ascii, CurrentFile.encoding_binary];

   function is_editable_file(file_extension) {
       if (['md', 'txt'].indexOf(file_extension) === -1) {
           return false;
       }
       return true;
   }

   var _current_file = new CurrentFile();
   var _current_file_edited = false;
   var _current_workdir = new Path();
   var _poll_timer = null;
   var NOTIFICATION_SOURCE_BROWSER = 'browser';

   function _handle_poll_timer() {
       zyn_poll_server();
   }

   function _stop_poll_timer() {
       window.clearTimeout(_poll_timer);
       _poll_timer = null;
   }

   function _start_poll_timer(duration_seconds) {
       if (_poll_timer !== null) {
           _stop_poll_timer();
       }
       _poll_timer = window.setInterval(_handle_poll_timer, duration_seconds * 1000);
   }

   _ERROR_CONNECTION = 'Connection problem';
   _ERROR_CRITICAL = 'Critical error';
   _ERROR_OPERATION = 'Operational problem';
   function _show_error(criticality, description, detail=null)
   {
       document.getElementById("zyn-error-modal").style.display = "block";
       document.getElementById("zyn-error-criticality").innerText = criticality
       document.getElementById("zyn-error-description").innerText = description;
       document.getElementById("zyn-error-detail").innerText = null;
       document.getElementById("zyn-error-detail").style.display = "none";
       document.getElementById("zyn-button-show-error-detail").style.display = "none";
       if (detail !== null) {
           document.getElementById("zyn-button-show-error-detail").style.display = "inline";
           document.getElementById("zyn-error-detail").innerText = detail;
       }
   }

   function _unhandled(description) {
       _show_error(_ERROR_CRITICAL, 'Unhandled event', description);
   }

   function _handle_notification(notification) {
       // console.log(notification)
       var source = notification['source'];
       var type_of = notification['type'];
       var content = notification['content'];
       if (source === 'web-server') {
           if (type_of == 'reconnect') {
               _add_notification(source, 'Web server reconncted to Zyn server');
           } else {
               alert('Unhamdled notification type for web server');
           }
       } else if (source === 'zyn-server') {
           if (type_of === 'disconnected') {
               _add_notification(
                   source,
                   'Zyn server disconnected, message from node: ' + content['reason']
               );
           } else {
               alert('not imeplemented')
           }
       } else {
           alert('Unhamdled notification source');
       }
   }

   function _handle_disconnected() {
       _stop_poll_timer();
       _show_error(_ERROR_CONNECTION, "Connection to Web server lost, try again after while");
   }

   function _set_button_enabled(name, enabled) {
       var button = document.getElementById(name);
       if (enabled) {
           button.classList.remove("w3-disabled");
       } else {
           button.classList.add("w3-disabled");
       }
   }

   function _handle_toggle_sidebar_button_clicked() {
       var sidebar = document.getElementById('zyn-sidebar');
       if (sidebar.dataset.size === 'min') {
           _set_sidebar_size('large');
       } else if (sidebar.dataset.size === 'large') {
           _set_sidebar_size('min');
       } else {
           _unhandled('_set_sidebar_size: Unhandled value dataset.size: ' + sidebar.dataset.size);
       }
   }

   function _set_sidebar_size(size) {

       if (size === 'min') {
           document.getElementById('zyn-sidebar').style.width = '5%'
           document.getElementById('zyn-content').style.marginLeft = '7%'
       } else if (size === 'large') {
           document.getElementById('zyn-sidebar').style.width = '500px'
           document.getElementById('zyn-content').style.marginLeft = '505px'
       } else {
           _unhandled('_set_sidebar_size: Unhandled value size' + size);
           return ;
       }
       document.getElementById('zyn-sidebar').dataset.size = size;
   }

   function _set_current_file(current_file)
   {
       _clear_current_file();
       document.getElementById('zyn-current-file-name').innerText = current_file.name();
       document.getElementById('zyn-current-file-node-id').innerText = current_file.node_id();
       document.getElementById('zyn-current-file-revision').innerText = current_file.revision();
       document.getElementById('zyn-current-file-encoding').innerText = current_file.encoding();
       if (current_file.type_of_file() === CurrentFile.file_type_random_access) {
           document.getElementById('zyn-current-file-type').innerText = "Random Access";
       } else if (current_file.type_of_file() === CurrentFile.file_type_blob) {
           document.getElementById('zyn-current-file-type').innerText = "Blob";
       } else {
           _unhandled('_set_current_file: current_file.type_of_file');
       }

       if (current_file.is_editable()) {
           if (current_file.mode() === CurrentFile.mode_view) {
               _set_button_enabled('zyn-current-file-button-edit', true);
               _set_button_enabled('zyn-current-file-button-done', false);
               _set_button_enabled('zyn-current-file-button-save', false);
               _set_button_enabled('zyn-current-file-button-cancel', false);
           } else if (current_file.mode() === CurrentFile.mode_edit) {
               _set_button_enabled('zyn-current-file-button-edit', false);
               _set_button_enabled('zyn-current-file-button-done', true);
               _set_button_enabled('zyn-current-file-button-save', true);
               _set_button_enabled('zyn-current-file-button-cancel', true);
           }
       }
   }

   function _clear_current_file()
   {
       document.getElementById('zyn-current-file-name').innerText = "";
       document.getElementById('zyn-current-file-node-id').innerText = "";
       document.getElementById('zyn-current-file-type').innerText = "";
       document.getElementById('zyn-current-file-revision').innerText = "";
       document.getElementById('zyn-current-file-encoding').innerText = "";
       _set_button_enabled('zyn-current-file-button-edit', false);
       _set_button_enabled('zyn-current-file-button-done', false);
       _set_button_enabled('zyn-current-file-button-save', false);
       _set_button_enabled('zyn-current-file-button-cancel', false);
   }

   function _add_notification(source, description)
   {
       var notifications = document.getElementById("zyn-notifications");
       var size = notifications.rows.length;
       if (size > 5) {
           notifications.deleteRow(size - 1);
       }
       var row = notifications.insertRow(1);
       row.insertCell().innerText = source;
       row.insertCell().innerText = description;
       _update_shown_notifications();
   }

   function _update_shown_notifications()
   {
       var notifications = document.getElementById('zyn-button-show-or-hide-notifications')
       if (notifications.dataset.state == 'show') {
           _change_notifications_display('none');
       } else if (notifications.dataset.state == 'hide') {
           _change_notifications_display('');
       } else {
           _unhandled('_update_shown_notifications: state: ' + notifications.dataset.state);
       }
   }

   function _change_notifications_display(display_style)
   {
       var notifications = document.getElementById("zyn-notifications");
       var size = notifications.rows.length;
       if (size < 2) {
           return ;
       }

       for (i = 2; i < size; i++) {
           notifications.rows[i].style.display = display_style
       }
   }

   function _handle_show_hide_notifications_clicked()
   {
       var notifications = document.getElementById('zyn-button-show-or-hide-notifications');

       if (notifications.dataset.state === 'show') {
           notifications.dataset.state = 'hide';
           notifications.innerText = 'Hide';
           _change_notifications_display('');
       } else if (notifications.dataset.state === 'hide') {
           notifications.dataset.state = 'show';
           notifications.innerText = 'Show';
           _change_notifications_display('none');
       } else {
           _unhandled('_handle_show_hide_notifications_clicked: state: ' + notifications.dataset.state);
       }
   }

   function _handle_save_edit_clicked()
   {
       if (! _current_file.is_set()) {
           return
       }

       if (_current_file.mode() !== CurrentFile.mode_edit) {
           return ;
       }

       if (! _current_file_edited) {
           return ;
       }

       var content_element = document.getElementById('zyn-edit-content');
       edited_content = content_element.innerText;

       if (_current_file.encoding() == CurrentFile.encoding_utf8) {
           edited_content = utf8.encode(edited_content);
       } else if (_current_file.encoding() == CurrentFile.encoding_ascii) {
           edited_content = escape(edited_content);
       }

       if (_current_file.type_of_file() === CurrentFile.file_type_random_access) {
           _show_loading_indication();
           zyn_edit_file_random_access(
               _current_file.node_id(),
               _current_file.revision(),
               _current_file.type_of_file(),
               _current_file.bytes(),
               edited_content,
               new Transaction(function (rsp, state) {
                   _hide_loading_indication();
                   _current_file.update_content(rsp['revision'], state['edited-content']);
                   _set_current_file(_current_file);
                   _current_file_edited = false;
               }, state={'edited-content': edited_content})
           );
       } else if (_current_file.type_of_file() === CurrentFile.file_type_blob) {
           _show_loading_indication();
           zyn_edit_file_blob(
               _current_file.node_id(),
               _current_file.revision(),
               _current_file.type_of_file(),
               edited_content,
               new Transaction(function (rsp, state) {
                   _hide_loading_indication();
                   _current_file.update_content(rsp['revision'], state['edited-content']);
                   _set_current_file(_current_file);
                   _current_file_edited = false;
               }, state={'edited-content': edited_content})
           );
       } else {
           _unhandled('_handle_save_edit_clicked: unknown type of file: ' + _current_file.type_of_file());
       }
   }

   function _handle_cancel_clicked()
   {
       if (! _current_file.is_set()) {
           return
       }

       if (_current_file.mode() !== CurrentFile.mode_edit) {
           return ;
       }

       _set_current_file_content();
       _current_file.set_mode(CurrentFile.mode_view);
       _set_current_file(_current_file);
   }

   function _handle_edit_clicked()
   {
       if (! _current_file.is_set()) {
           return
       }

       if (_current_file.mode() === CurrentFile.mode_edit) {
           return ;
       }

       var content_element = document.getElementById('zyn-document-content');
       content_element.innerHTML =
           '<pre id="zyn-edit-content" contenteditable="true" '
           + 'class="w3-pale-green" '
           + 'onkeyup="_handle_file_keypressed_on_file_content()"'
           + '>'
           + _current_file.decoded()
           + '</pre>'
       ;

       _current_file.set_mode(CurrentFile.mode_edit);
       _set_current_file(_current_file)
       _current_file_edited = false;
   }

   function _handle_edit_done_clicked()
   {
       if (! _current_file.is_set()) {
           return
       }

       if (_current_file.mode() !== CurrentFile.mode_edit) {
           return ;
       }

       if (_current_file_edited) {
           if (!confirm('Unsaved edits will be lost, Ok?')) {
               return ;
           }
       }
       _handle_cancel_clicked();
   }

   function _handle_file_keypressed_on_file_content()
   {
       _current_file_edited = true;
   }

   function _set_current_workdir(path) {
       var path_element = document.getElementById('zyn-current-path');
       path_element.value = path;
   }

   function _handle_refresh_content_clicked() {
       _fetch_and_set_folder_content(_current_workdir.clone());
   }

   function _handle_change_current_workdir_rsp(rsp, transaction_state) {
       if (rsp['description']['type-of-element'] === 'directory') {
           var path = transaction_state['path'];
           _set_current_workdir(path.to_str());
           _fetch_and_set_folder_content(path);
           _current_workdir = path;
       } else {
           _show_error(_ERROR_OPERATION, "Target is not folder");
       }
   }

   function _handle_parent_directory_clicked()
   {
       var path = _current_workdir.clone();
       path.parent();

       if (_current_workdir.is_equal(path)) {
           return ;
       }

       zyn_query_filesystem_element(path, new Transaction(
           _handle_change_current_workdir_rsp,
           state={'path': path}
       ));
   }

   function _handle_folder_content_list_item_clicked(element_type, name, node_id) {

       if (element_type === 'dir') {
           var path = _current_workdir.clone();
           path.append(name);

           zyn_query_filesystem_element(path, new Transaction(
               _handle_change_current_workdir_rsp,
               state={'path': path}
           ));

       } else if (element_type === 'file') {
           _show_loading_indication();
           zyn_load_file(node_id, name, new Transaction(
               _handle_load_file_rsp,
               state={'mode': 'view'}
           ));
       }
   }

   function _sort_workdir_content_by_type(a, b) {
       var type_a = a.cells[0].innerText;
       var type_b = b.cells[0].innerText;
       if (type_a === type_b) {
           return 0;
       } else if (type_a === 'dir') {
           return -1;
       }
       return 1;
   }

   function _sort_workdir_content(listing, sort_function) {
       var rows = []
       for (var i = 1; i < listing.rows.length; i++) {
           rows.push(listing.rows[i]);
       }
       rows.sort(sort_function);
       while (listing.rows.length > 1) {
           listing.deleteRow(listing.rows.length - 1);
       }
       for (var i = 0; i < rows.length; i++) {
           listing.appendChild(rows[i]);
       }
   }

   function _handle_load_file_rsp(msg, state)
   {
       _hide_loading_indication();
       _current_file.change_to(
           msg['filename'],
           msg['node-id'],
           msg['revision'],
           msg['file-type'],
           atob(msg['bytes'])
       );

       _set_current_file(_current_file);
       _set_current_file_content();

       var mode = state['mode'];
       if (mode === 'view') {
           // pass
       } else if (mode === 'edit') {
           _handle_edit_clicked();
       } else {
           _unhandled('_handle_load_file_rsp: Unhandled mode: ' + mode);
       }
   }

   function _set_current_file_content()
   {
       var content_element = document.getElementById('zyn-document-content');
       zyn_render_file_content(content_element, _current_file);
   }

  </script>

  <script>
   var tab_name_files = "tab-files";
   var tab_name_settings = "tab-settings";
   function _set_vissible_tab(tab_name) {
       var tabs = document.getElementsByClassName("zyn-tabs");
       for(let tab of tabs) {
           tab.style.display = "none";
       }
       document.getElementById(tab_name).style.display = "block";
   }

  </script>

  <script type="text/javascript">

   /*
      Initialization
    */
   _set_vissible_tab(tab_name_files);
   _clear_current_file();
   _change_notifications_display('none');
   _set_sidebar_size('large');

   {% if is_logged_in == 0 %}

   document.getElementById("zyn-login-modal").style.display = "block"

   {% elif is_logged_in == 1 %}

   zyn_init(
       "{{ user_id }}",
       _handle_notification,
       _handle_disconnected,
       new Transaction(function (_, _) {
           var path = _current_workdir.clone();
           _set_current_workdir(path.to_str());
           _fetch_and_set_folder_content(path);
           _start_poll_timer(5);
           zyn_log_on_server('Client ready');
       }));

   {% end %}

  </script>

</body>
</html>
